<!--
 * @Author: wh_lvbowen lvbowen@yunlizhihui.com
 * @Date: 2022-05-17 18:28:29
 * @LastEditors: wh_lvbowen lvbowen@yunlizhihui.com
 * @LastEditTime: 2022-05-17 19:24:34
-->

# 广东智慧河长管理系统项目复盘

供广东省水利厅河长办使用的管理全省河流、碧道、河长人员等综合信息化平台，包括首页、协同精细化、碧道工程建设管理、综合信息管理、考核评价、河长制知识库、决策管理、专项任务管理、系统管理、河湖应用等模块，共计 200+ 页面。

> 其中河湖应用是 iframe 内嵌赋安和云瑶的系统页面，菜单是通过我们系统配的，只是右边内容区用的 iframe 容器，src 使用相对路径然后走 nginx 代理

技术栈：umi + antd + ProComponents + @umijs/plugin-qiankun + axios + less

## 微前端架构

模块较多，通过 @umijs/plugin-qiankun 进行微前端架构，各模块独立开发部署。
主应用配置，子应用以首页为例：

```js
// config/config.js
// 微应用注册
  qiankun: {
    master: {
      // 取消沙箱隔离，因为是首页子应用sdk取得window对象不能使用隔离，否则会报错！
      sandbox: false,
      // 注册子应用信息
      apps: [
        {
          name: 'micro-home-app',
          entry: '/Home', // 这里使用相对路径，自定义前缀，然后通过 nginx 代理到子应用的地址，如果写死全路径地址不同环境不好维护
        },
      ],
    },
  }

// docker/default.conf.template
// 主应用 nginx 配置代理
location ^~ /Home { // 和 entry 的路径一样，微应用的打包的 publicPath 需要配置成 /Home/，否则微应用的 index.html 能正确请求，但是微应用 index.html 里面的 js/css 资源请求不到。
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    # 从环境变量取转发地址
    proxy_pass ${HOME_URL};  // HOME_URL = http://172.26.30.176:31284/
}
```

子应用配置（都是基于 umi）：

```js
// config/config.js
  qiankun: {
    slave: {},
  },

```

## 云瑶赋安内嵌

## 权限管理

## splitChunks 拆包

## docker 部署
